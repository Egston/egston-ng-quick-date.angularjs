(function(){var a;a=angular.module("ngQuickDate",[]),a.provider("ngQuickDateDefaults",function(){return{options:{dateFormat:"M/d/yyyy",timeFormat:"h:mm a",labelFormat:null,placeholder:"Click to Set Date",hoverText:null,buttonIconHtml:null,closeButtonHtml:"&times;",nextLinkHtml:"Next &rarr;",prevLinkHtml:"&larr; Prev",disableTimepicker:!1,disableClearButton:!1,defaultTime:null,dayAbbreviations:["Su","M","Tu","W","Th","F","Sa"],dateFilter:null,timezone:null,parseDateFunction:function(a){var b;return b=Date.parse(a),isNaN(b)?null:new Date(b)}},$get:function(){return this.options},set:function(a,b){var c,d,e;if("object"==typeof a){e=[];for(c in a)d=a[c],e.push(this.options[c]=d);return e}return this.options[a]=b}}}),a.directive("quickDatepicker",["ngQuickDateDefaults","$filter","$sce","$log",function(a,b,c,d){return{restrict:"E",require:"?ngModel",scope:{dateFilter:"=?",disableTimepicker:"=?",timezone:"=?",onChange:"&",required:"@"},replace:!0,link:function(e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;return p="00:00:00",o=function(a){return d.debug("[quickdate] "+a)},P=new Date(2013,0,1,12,0),z=function(){return E(),e.toggleCalendar(!1),e.weeks=[],e.inputDate=null,e.inputTime=null,e.invalid=!0,"string"==typeof g.initValue&&h.$setViewValue(g.initValue),D(),C()},e.getDatePlaceholder=function(){return b("date")(P,e.getDateFormat())},e.getTimePlaceholder=function(){return b("date")(P,e.getTimeFormat())},e.getDateFormat=function(){return"UTC"===e.timezone?"yyyy-MM-dd":e.dateFormat},e.getTimeFormat=function(){return"UTC"===e.timezone?"HH:mm:ss":e.timeFormat},e.getLabelFormat=function(){var a;return null!=(a=e.labelFormat)?a:e.disableTimepicker?e.getDateFormat():e.getDateFormat()+" "+e.getTimeFormat()},E=function(){var b,d,f;o("setting configuration");for(b in a)d=a[b],b.match(/[Hh]tml/)?e[b]=c.trustAsHtml(a[b]||""):null==e[b]&&(e[b]=null!=(f=g[b])?f:a[b]);return g.iconClass&&g.iconClass.length?e.buttonIconHtml=c.trustAsHtml("<i ng-show='iconClass' class='"+g.iconClass+"'></i>"):void 0},k=!1,window.document.addEventListener("click",function(){return e.calendarShown&&!k&&(e.toggleCalendar(!1),e.$apply()),k=!1}),angular.element(f[0])[0].addEventListener("click",function(){return k=!0}),C=function(){var a;return o("refreshView"),a=h.$modelValue?B(h.$modelValue):null,N(),I(a),e.mainButtonStr=a?b("date")(a,e.getLabelFormat(),e.timezone):e.placeholder,e.invalid=h.$invalid},I=function(a){return null!=a?(e.inputDate=b("date")(a,e.getDateFormat(),e.timezone),e.inputTime=b("date")(a,e.getTimeFormat(),e.timezone)):(e.inputDate=null,e.inputTime=null)},D=function(a){var b;return null==a&&(a=null),b=null!=a?new Date(a):new Date,"Invalid Date"===b.toString()&&(b=new Date),A()?b.setUTCDate(1):b.setDate(1),e.calendarDate=new Date(b),o("set calendarDate to "+e.calendarDate.toISOString())},N=function(){var a,b,c,d,f,g,i,j,k,m,n,p,u,v,w,y,z;for(o("setting up calendar view"),g=r(e.calendarDate),d=s(t(e.calendarDate),x(e.calendarDate)),f=Math.ceil((g+d)/7),n=[],a=new Date(e.calendarDate),F(a,q(a)+-1*g),i=p=0,v=f-1;v>=0?v>=p:p>=v;i=v>=0?++p:--p)for(n.push([]),c=u=0;6>=u;c=++u)b=new Date(a),e.defaultTime&&(k=e.defaultTime.split(":"),H(b,null!=(w=k[0])?w:0),K(b,null!=(y=k[1])?y:0),M(b,null!=(z=k[2])?z:0)),j=h.$modelValue&&b&&l(b,h.$modelValue),m=l(b,new Date),n[i].push({date:b,selected:j,disabled:"function"==typeof e.dateFilter?!e.dateFilter(b):!1,other:x(b)!==x(e.calendarDate),today:m}),F(a,q(a)+1);return e.weeks=n},h.$parsers.push(function(a){return e.required&&null==a?(h.$setValidity("required",!1),null):angular.isDate(a)?(h.$setValidity("required",!0),a):angular.isString(a)?(h.$setValidity("required",!0),e.parseDateFunction(a)):null}),h.$formatters.push(function(a){return angular.isDate(a)?a:angular.isString(a)?e.parseDateFunction(a):void 0}),A=function(){return"UTC"===e.timezone},q=function(a){return A()?a.getUTCDate():a.getDate()},r=function(a){return A()?a.getUTCDay():a.getDay()},t=function(a){return A()?a.getUTCFullYear():a.getFullYear()},u=function(a){return A()?a.getUTCHours():a.getHours()},v=function(a){return A()?a.getUTCMilliseconds():a.getMilliseconds()},w=function(a){return A()?a.getUTCMinutes():a.getMinutes()},x=function(a){return A()?a.getUTCMonth():a.getMonth()},y=function(a){return A()?a.getUTCSeconds():a.getSeconds()},F=function(a,b){return A()?a.setUTCDate(b):a.setDate(b)},G=function(a,b){return A()?a.setUTCFullYear(b):a.setFullYear(b)},H=function(a,b){return A()?a.setUTCHours(b):a.setHours(b)},J=function(a,b){return A()?a.setUTCMilliseconds(b):a.setMilliseconds(b)},K=function(a,b){return A()?a.setUTCMinutes(b):a.setMinutes(b)},L=function(a,b){return A()?a.setUTCMonth(b):a.setMonth(b)},M=function(a,b){return A()?a.setUTCSeconds(b):a.setSeconds(b)},j=function(a,c){return b("date")(a,c,e.timezone)},O=function(a){return"string"==typeof a?B(a):a},B=a.parseDateFunction,i=function(a,b){return"UTC"===e.timezone?""+a+"T"+b+"Z":""+a+" "+b},l=function(a,b,c){return null==c&&(c=!1),c?a-b===0:(a=O(a),b=O(b),a&&b&&t(a)===t(b)&&x(a)===x(b)&&q(a)===q(b))},m=function(a,b){return a&&b?parseInt(a.getTime()/6e4)===parseInt(b.getTime()/6e4):!1},s=function(a,b){return[31,a%4===0&&a%100!==0||a%400===0?29:28,31,30,31,30,31,31,30,31,30,31][b]},n=function(a,b){var c,d,e,f,g,h;return g=c=d=h=f=null,e=function(){var a;return a=+new Date-h,g=b>a&&a>0?setTimeout(e,b-a):null},function(){return d=this,c=arguments,h=+new Date,g||(g=setTimeout(e,b),f=a.apply(d,c),d=c=null),f}},h.$render=function(){return D(h.$viewValue),C()},h.$viewChangeListeners.unshift(function(){return D(h.$viewValue),C(),e.onChange?e.onChange():void 0}),e.$watch("calendarShown",function(a){var b;return a?(b=angular.element(f[0].querySelector(".quickdate-date-input"))[0],b.select()):void 0}),e.$watch("timezone",function(a,b){return a!==b?C():void 0}),e.$watch("disableTimepicker",function(a,b){return a!==b?C():void 0}),e.toggleCalendar=n(function(a){return e.calendarShown=isFinite(a)?a:!e.calendarShown},150),e.selectDate=function(a,b){var c;return null==b&&(b=!0),o("selectDate: "+(null!=a?a.toISOString():void 0)),c=!h.$viewValue&&a||h.$viewValue&&!a||a&&h.$viewValue&&a.getTime()!==h.$viewValue.getTime(),"function"!=typeof e.dateFilter||e.dateFilter(a)?(h.$setViewValue(a),b&&e.toggleCalendar(!1),!0):!1},e.selectDateWithMouse=function(a){return e.selectDate(a,e.disableTimepicker)},e.selectDateFromInput=function(a){var b,c,d,f,g;null==a&&(a=!1),o("selectDateFromInput");try{if(c=B(i(e.inputDate,p)),null==c)throw new Error("Invalid Date");if(!e.disableTimepicker&&(null!=(g=e.inputTime)?g.length:void 0)){if(f=e.disableTimepicker?p:e.inputTime,d=B(i(e.inputDate,f)),null==d)throw new Error("Invalid Time");c=d}if(!m(h.$viewValue,c)&&!e.selectDate(c,!1))throw new Error("Invalid Date");return a&&e.toggleCalendar(!1),e.inputDateErr=!1,e.inputTimeErr=!1}catch(j){if(b=j,"Invalid Date"===b.message)return e.inputDateErr=!0;if("Invalid Time"===b.message)return e.inputTimeErr=!0}},e.onDateInputTab=function(){return e.disableTimepicker&&e.toggleCalendar(!1),!0},e.onTimeInputTab=function(){return e.toggleCalendar(!1),!0},e.nextMonth=function(){return D(new Date(L(new Date(e.calendarDate),x(e.calendarDate)+1))),C()},e.prevMonth=function(){return D(new Date(L(new Date(e.calendarDate),x(e.calendarDate)-1))),C()},e.clear=function(){return e.selectDate(null,!0)},z()},template:"<div class='quickdate'>\n  <a href='' ng-focus='toggleCalendar()' ng-click='toggleCalendar()'\n      class='quickdate-button' title='{{hoverText}}'>\n    <div ng-hide='iconClass' ng-bind-html='buttonIconHtml'></div>\n    {{mainButtonStr}}\n  </a>\n  <div class='quickdate-popup' ng-class='{open: calendarShown}'>\n    <a href='' tabindex='-1' class='quickdate-close' ng-click='toggleCalendar()'>\n      <div ng-bind-html='closeButtonHtml'></div>\n    </a>\n    <div class='quickdate-text-inputs'>\n      <div class='quickdate-input-wrapper'>\n        <label>Date</label>\n        <input class='quickdate-date-input' ng-class=\"{'ng-invalid': inputDateErr}\"\n               name='inputDate' type='text' ng-model='inputDate'\n               placeholder='{{ getDatePlaceholder() }}'\n               ng-enter=\"selectDateFromInput(true)\"\n               ng-blur=\"selectDateFromInput(false)\"\n               on-tab='onDateInputTab()' />\n      </div>\n      <div class='quickdate-input-wrapper' ng-hide='disableTimepicker'>\n        <label>Time</label>\n        <input class='quickdate-time-input'\n               ng-class=\"{'ng-invalid': inputTimeErr}\"\n               name='inputTime'\n               type='text'\n               ng-model='inputTime'\n               placeholder='{{ getTimePlaceholder() }}'\n               ng-enter=\"selectDateFromInput(true)\"\n               ng-blur=\"selectDateFromInput(false)\"\n               on-tab='onTimeInputTab()'>\n      </div>\n    </div>\n    <div class='quickdate-calendar-header'>\n      <a href='' class='quickdate-prev-month quickdate-action-link' tabindex='-1' ng-click='prevMonth()'>\n        <div ng-bind-html='prevLinkHtml'></div>\n      </a>\n      <span class='quickdate-month'>{{calendarDate | date:'MMMM yyyy'}}</span>\n      <a href='' class='quickdate-next-month quickdate-action-link' ng-click='nextMonth()' tabindex='-1' >\n        <div ng-bind-html='nextLinkHtml'></div>\n      </a>\n    </div>\n    <table class='quickdate-calendar'>\n      <thead>\n        <tr>\n          <th ng-repeat='day in dayAbbreviations'>{{day}}</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat='week in weeks'>\n          <td ng-mousedown='selectDateWithMouse(day.date)'\n              ng-click='$event.preventDefault()'\n              ng-class='{\"other-month\": day.other, \"disabled-date\": day.disabled, \"selected\": day.selected, \"is-today\": day.today}'\n              ng-repeat='day in week'>{{day.date | date:'d':timezone}}</td>\n        </tr>\n      </tbody>\n    </table>\n    <div class='quickdate-popup-footer'>\n      <a href='' class='quickdate-clear' tabindex='-1' ng-hide='disableClearButton' ng-click='clear()'>Clear</a>\n    </div>\n  </div>\n</div>"}}]),a.directive("ngEnter",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return 13===b.which?(a.$apply(c.ngEnter),b.preventDefault()):void 0})}}),a.directive("onTab",function(){return{restrict:"A",link:function(a,b,c){return b.bind("keydown keypress",function(b){return 9!==b.which||b.shiftKey?void 0:a.$apply(c.onTab)})}}})}).call(this);